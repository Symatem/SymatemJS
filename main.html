<html>
    <body>
        <input id="fileInput" type="file" />
        <script src="Symatem.js"></script>
        <script>

            function loadWasmModule() {
                if(typeof WebAssembly !== "object") {
                    errorHandler("WebAssembly is not supported or disabled.");
                    return;
                }
                var xhr = new XMLHttpRequest();
                xhr.open("GET", "build/Symatem.wasm", true);
                xhr.responseType = "arraybuffer";
                xhr.onload = function(event) {
                    Symatem.initImage(new Uint8Array(xhr.response)).then(function() {

                    });
                };
                xhr.onerror = function(error) {
                    console.log(error);
                };
                xhr.send(null);
            }

            function saveImage() {
                var a = document.createElement("a");
                var file = new Blob([Symatem.saveImage()]);
                a.href = URL.createObjectURL(file);
                a.download = "Image";
                a.click();
            }

            function loadImage(event) {
                event.stopPropagation();
                event.preventDefault();
                var input = event.dataTransfer || event.target;
                if(!input || !input.files || input.files.length != 1)
                    return;
                var file = input.files[0], reader = new FileReader();
                reader.onload = function(event) {
                    Symatem.loadImage(new Uint8Array(reader.result));
                };
                reader.onerror = function(error) {
                    console.log(error);
                };
                reader.readAsArrayBuffer(file);
            }

            document.getElementById("fileInput").addEventListener("change", loadImage, false);
            document.addEventListener("dragover", function(event) {
                event.stopPropagation();
                event.preventDefault();
                event.dataTransfer.dropEffect = "copy";
            }, false);
            document.addEventListener("drop", loadImage, false);

            loadWasmModule();
        </script>
    </body>
</html>
